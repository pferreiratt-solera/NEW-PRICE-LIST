<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Angostura Price List — Nov 9, 2025</title>
  <style>
    html,body{margin:0;padding:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#0b0b0b;color:#eaeaea}
    header{position:sticky;top:0;background:#0b0b0b;z-index:10;border-bottom:1px solid #222;padding:12px 16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    input,select{background:#141414;border:1px solid #2a2a2a;color:#eaeaea;padding:10px 12px;border-radius:10px;outline:none}
    input::placeholder{color:#9a9a9a}
    .pill{padding:6px 10px;border:1px solid #2a2a2a;border-radius:999px}
    .container{padding:16px;max-width:1200px;margin:0 auto}
    table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
    th,td{padding:10px;border-bottom:1px solid #1f1f1f;vertical-align:top}
    th{text-align:left;cursor:pointer;user-select:none;position:sticky;top:64px;background:#0b0b0b}
    tr:hover td{background:#111}
    .badge{display:inline-block;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;padding:2px 6px;font-size:12px;color:#bdbdbd}
    .meta{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;color:#bdbdbd;font-size:12px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .count{margin-left:auto;color:#bdbdbd;font-size:13px}
    a.btn{text-decoration:none}
    .btn{display:inline-block;background:#141414;border:1px solid #2a2a2a;padding:10px 12px;border-radius:10px;color:#eaeaea}
    .btn:hover{background:#171717}
    .nowrap{white-space:nowrap}
  </style>
</head>
<body>
  <header>
    <strong>Angostura Price List — Nov 9, 2025</strong>
    <span class="pill">Sheets: Sheet1</span>
    <div class="toolbar">
      <input id="q" type="search" placeholder="Search product, size, SKU, etc."/>
      <select id="sheetFilter"><option value="">All Sheets</option></select>
      <button id="exportBtn" class="btn">Export CSV (filtered)</button>
      <span id="count" class="count"></span>
    </div>
  </header>
  <div class="container">
    <div id="tableWrap"></div>
    <div class="meta">
      <span class="badge">Rows: <span id="rowCount">0</span></span>
      <span class="badge">Columns: <span id="colCount">0</span></span>
      <a class="btn" href="./data.json" download>Download data.json</a>
    </div>
  </div>
  <script>
    const state = {
      data: [],
      filtered: [],
      columns: [],
      sortKey: null,
      sortAsc: true,
    };

    function inferColumns(rows) {
      const keys = new Set();
      rows.slice(0,50).forEach(r=>Object.keys(r).forEach(k=>keys.add(k)));
      const arr = Array.from(keys);
      arr.sort((a,b)=> a=== "_Sheet" ? -1 : b==="_Sheet" ? 1 : a.localeCompare(b));
      return arr;
    }

    function fmt(v) {
      if (v === null || v === undefined) return "";
      if (typeof v === "number") return Number.isInteger(v) ? v.toString() : v.toFixed(2);
      return String(v);
    }

    function renderTable() {
      const wrap = document.getElementById("tableWrap");
      const cols = state.columns;
      const rows = state.filtered;
      document.getElementById("rowCount").textContent = rows.length;
      document.getElementById("colCount").textContent = cols.length;

      let thead = "<thead><tr>" + cols.map(c=>`<th data-key="${c}">${c}</th>`).join("") + "</tr></thead>";
      let tbody = "<tbody>" + rows.map(r=>"<tr>"+cols.map(c=>`<td>${fmt(r[c])}</td>`).join("")+"</tr>").join("") + "</tbody>";
      wrap.innerHTML = `<table>${thead}{tbody}</table>`;

      wrap.querySelectorAll("th").forEach(th=>{
        th.addEventListener("click", ()=>{
          const key = th.dataset.key;
          if (state.sortKey === key) state.sortAsc = !state.sortAsc; else { state.sortKey = key; state.sortAsc = true; }
          state.filtered.sort((a,b)=>{
            const va = a[key]; const vb = b[key];
            if (va == null && vb == null) return 0;
            if (va == null) return state.sortAsc ? -1 : 1;
            if (vb == null) return state.sortAsc ? 1 : -1;
            if (typeof va === "number" && typeof vb === "number") return state.sortAsc ? va - vb : vb - va;
            return state.sortAsc ? String(va).localeCompare(String(vb)) : String(vb).localeCompare(String(va));
          });
          renderTable();
        });
      });

      document.getElementById("count").textContent = `${rows.length} results`;
    }

    function applyFilters() {
      const q = document.getElementById("q").value.trim().toLowerCase();
      const sheet = document.getElementById("sheetFilter").value;
      state.filtered = state.data.filter(r=>{
        if (sheet && r._Sheet !== sheet) return false;
        if (!q) return true;
        return state.columns.some(c => (r[c]!==null && r[c]!==undefined && String(r[c]).toLowerCase().includes(q)));
      });
      renderTable();
    }

    function exportCSV(rows, cols) {
      const header = cols.join(",");
      const body = rows.map(r=>cols.map(c=>{
        let v = r[c];
        if (v===null || v===undefined) v = "";
        v = String(v).replace(/"/g,'""');
        if (v.includes(",") || v.includes(""") || v.includes("\n")) v = `"${v}"`;
        return v;
      }).join(",")).join("\n");
      const csv = header + "\n" + body;
      const blob = new Blob([csv], {type:"text/csv"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "angostura_prices_filtered.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    async function init() {
      const res = await fetch("data.json");
      const data = await res.json();
      state.data = data;
      state.columns = inferColumns(data);
      const sheets = Array.from(new Set(data.map(d=>d._Sheet))).sort();
      const sel = document.getElementById("sheetFilter");
      sheets.forEach(s=>{ const o = document.createElement("option"); o.value = s; o.textContent = s; sel.appendChild(o); });
      applyFilters();
    }

    document.getElementById("q").addEventListener("input", applyFilters);
    document.getElementById("sheetFilter").addEventListener("change", applyFilters);
    document.getElementById("exportBtn").addEventListener("click", ()=>exportCSV(state.filtered, state.columns));
    init();
  </script>
</body>
</html>
